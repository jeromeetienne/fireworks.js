var Fireworks={debug:!0,EffectsStackBuilder:function(a){this._emitter=a}};Fireworks.EffectsStackBuilder.prototype.emitter=function(){return this._emitter};Fireworks.EffectsStackBuilder.prototype.back=function(){return this._emitter};Fireworks.EffectsStackBuilder.prototype.createEffect=function(a,b){var c=Fireworks.createEffect(a,b).pushTo(this._emitter).back(this);c.effect().emitter(this._emitter);return c};
Fireworks.createEffect=function(a,b){"object"===typeof a&&(b=a,a=void 0);var c=new Fireworks.Effect;c.opts=b;c.name=a;c.back=null;var d={onCreate:function(a){c.onCreate=a;return d},onBirth:function(a){c.onBirth=a;return d},onUpdate:function(a){c.onUpdate=a;return d},onDeath:function(a){c.onDeath=a;return d},onPreUpdate:function(a){c.onPreUpdate=a;return d},onPreRender:function(a){c.onPreRender=a;return d},onRender:function(a){c.onRender=a;return d},onPostRender:function(a){c.onPostRender=a;return d},
onIntensityChange:function(a){c.onIntensityChange=a;return d},pushTo:function(a){a.effects().push(c);return d},back:function(a){if(void 0===a)return c.back;c.back=a;return d},effect:function(){return c}};return d};Fireworks.Effect=function(){this._emitter=null};Fireworks.Effect.prototype.destroy=function(){};Fireworks.Effect.prototype.emitter=function(a){if(void 0===a)return this._emitter;this._emitter=a;return this};Fireworks.createEmitter=function(a){return new Fireworks.Emitter(a)};
Fireworks.Emitter=function(a){this._nParticles=void 0!==a.nParticles?a.nParticles:100;this._particles=[];this._effects=[];this._started=!1;this._onUpdated=null;this._intensity=0;this._maxDeltaTime=1/3;this._effectsStackBuilder=new Fireworks.EffectsStackBuilder(this)};Fireworks.Emitter.prototype.destroy=function(){this._effects.forEach(function(a){a.destroy()});this._particles.forEach(function(a){a.destroy()})};Fireworks.Emitter.prototype.effects=function(){return this._effects};
Fireworks.Emitter.prototype.effect=function(a){for(var b=0;b<this._effects.length;b++){var c=this._effects[b];if(c.name===a)return c}return null};Fireworks.Emitter.prototype.particles=function(){return this._particles};Fireworks.Emitter.prototype.liveParticles=function(){return this._liveParticles};Fireworks.Emitter.prototype.deadParticles=function(){return this._deadParticles};Fireworks.Emitter.prototype.nParticles=function(){return this._nParticles};
Fireworks.Emitter.prototype.effectsStackBuilder=function(){return this._effectsStackBuilder};
Fireworks.Emitter.prototype.intensity=function(a){if(void 0===a)return this._intensity;if(a===this._intensity)return this;Fireworks.debug&&console.assert(0<=a,"Fireworks.Emitter.intensity: invalid value.",a);Fireworks.debug&&console.assert(1>=a,"Fireworks.Emitter.intensity: invalid value.",a);var b=this._intensity;this._intensity=a;this._effects.forEach(function(a){if(a.onIntensityChange)a.onIntensityChange(this._intensity,b)}.bind(this));return this};
Fireworks.Emitter.prototype.maxDeltaTime=function(a){if(void 0===a)return this._maxDeltaTime;this._maxDeltaTime=a;return this};Fireworks.Emitter.prototype.setParticleData=function(a,b,c){a[b]=c};Fireworks.Emitter.prototype.getParticleData=function(a,b){return a[b]};
Fireworks.Emitter.prototype.start=function(){console.assert(0<this._effects.length,"At least one effect MUST be set");console.assert(!1===this._started);this._particles=Array(this._nParticles);for(var a=0;a<this._nParticles;a++)this._particles[a]=new Fireworks.Particle;this._liveParticles=[];this._deadParticles=this._particles.slice(0);this._started=!0;this._effects.forEach(function(a){a.onCreate&&this._particles.forEach(function(c,d){a.onCreate(c,d)})}.bind(this));this.intensity(1);return this};
Fireworks.Emitter.prototype.update=function(a){a=Math.min(this._maxDeltaTime,a);this._effects.forEach(function(b){if(b.onPreUpdate)b.onPreUpdate(a)}.bind(this));this._effects.forEach(function(b){b.onUpdate&&this._liveParticles.forEach(function(c){b.onUpdate(c,a)})}.bind(this));return this};
Fireworks.Emitter.prototype.render=function(){this._effects.forEach(function(a){if(a.onPreRender)a.onPreRender()}.bind(this));this._effects.forEach(function(a){a.onRender&&this._liveParticles.forEach(function(b){a.onRender(b)})}.bind(this));this._effects.forEach(function(a){if(a.onPostRender)a.onPostRender()}.bind(this));return this};
Fireworks.Emitter.prototype.killParticle=function(a){var b=this._liveParticles.indexOf(a);Fireworks.debug&&console.assert(-1!==b);this._liveParticles.splice(b,1);this._deadParticles.push(a);this.effects().forEach(function(b){b.onDeath&&b.onDeath(a)}.bind(this))};
Fireworks.Emitter.prototype.spawnParticle=function(){Fireworks.debug&&console.assert(1<=this._deadParticles.length,"no more particle available");var a=this.deadParticles().pop();this.liveParticles().push(a);this.effects().forEach(function(b){b.onBirth&&b.onBirth(a)}.bind(this))};Fireworks.createLinearGradient=function(a){return new Fireworks.LinearGradient(a)};Fireworks.LinearGradient=function(){this._keyPoints=[]};
Fireworks.LinearGradient.prototype.push=function(a,b){this._keyPoints.push({x:a,y:b});return this};Fireworks.LinearGradient.prototype.get=function(a){for(var b=0;b<this._keyPoints.length&&!(a<=this._keyPoints[b].x);b++);if(0===b)return this._keyPoints[0].y;Fireworks.debug&&console.assert(b<this._keyPoints.length);var c=this._keyPoints[b-1],b=this._keyPoints[b];return c.y+(a-c.x)/(b.x-c.x)*(b.y-c.y)};Fireworks.Particle=function(){};
Fireworks.Particle.prototype.set=function(a,b){Fireworks.debug&&console.assert(void 0===this[a],"key already defined: "+a);this[a]=b;return this[a]};Fireworks.Particle.prototype.get=function(a){Fireworks.debug&&console.assert(void 0!==this[a],"key undefined: "+a);return this[a]};Fireworks.Particle.prototype.has=function(a){return void 0!==this[a]?!0:!1};Fireworks.Shape=function(){};Fireworks.createVector=function(a,b,c){return new Fireworks.Vector(a,b,c)};
Fireworks.Vector=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
Fireworks.Vector.prototype={constructor:Fireworks.Vector,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},random:function(){this.x=Math.random()-0.5;this.y=Math.random()-0.5;this.z=Math.random()-0.5;return this},toString:function(){return JSON.stringify(this)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=
a.z+b.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;
this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a):this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},
cross:function(a,b){this.x=a.y*b.z-a.z*b.y;this.y=a.z*b.x-a.x*b.z;this.z=a.x*b.y-a.y*b.x;return this},crossSelf:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return(new Fireworks.Vector).sub(this,a).lengthSq()},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},isZero:function(){return 1E-4>this.lengthSq()},clone:function(){return new Fireworks.Vector(this.x,
this.y,this.z)}};
